<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use BezhanSalleh\FilamentShield\Support\Utils;
use Spatie\Permission\PermissionRegistrar;

class ShieldSeeder extends Seeder
{
    public function run(): void
    {
        app()[PermissionRegistrar::class]->forgetCachedPermissions();

        $rolesWithPermissions = '[{"name":"super_admin","guard_name":"web","permissions":["view_amenity","view_any_amenity","create_amenity","update_amenity","restore_amenity","restore_any_amenity","replicate_amenity","reorder_amenity","delete_amenity","delete_any_amenity","force_delete_amenity","force_delete_any_amenity","view_booking","view_any_booking","create_booking","update_booking","restore_booking","restore_any_booking","replicate_booking","reorder_booking","delete_booking","delete_any_booking","force_delete_booking","force_delete_any_booking","view_car","view_any_car","create_car","update_car","restore_car","restore_any_car","replicate_car","reorder_car","delete_car","delete_any_car","force_delete_car","force_delete_any_car","view_chat","view_any_chat","create_chat","update_chat","restore_chat","restore_any_chat","replicate_chat","reorder_chat","delete_chat","delete_any_chat","force_delete_chat","force_delete_any_chat","view_contract","view_any_contract","create_contract","update_contract","restore_contract","restore_any_contract","replicate_contract","reorder_contract","delete_contract","delete_any_contract","force_delete_contract","force_delete_any_contract","view_driver","view_any_driver","create_driver","update_driver","restore_driver","restore_any_driver","replicate_driver","reorder_driver","delete_driver","delete_any_driver","force_delete_driver","force_delete_any_driver","view_employee","view_any_employee","create_employee","update_employee","restore_employee","restore_any_employee","replicate_employee","reorder_employee","delete_employee","delete_any_employee","force_delete_employee","force_delete_any_employee","view_expense","view_any_expense","create_expense","update_expense","restore_expense","restore_any_expense","replicate_expense","reorder_expense","delete_expense","delete_any_expense","force_delete_expense","force_delete_any_expense","view_guest","view_any_guest","create_guest","update_guest","restore_guest","restore_any_guest","replicate_guest","reorder_guest","delete_guest","delete_any_guest","force_delete_guest","force_delete_any_guest","view_guest::payment","view_any_guest::payment","create_guest::payment","update_guest::payment","restore_guest::payment","restore_any_guest::payment","replicate_guest::payment","reorder_guest::payment","delete_guest::payment","delete_any_guest::payment","force_delete_guest::payment","force_delete_any_guest::payment","view_guide","view_any_guide","create_guide","update_guide","restore_guide","restore_any_guide","replicate_guide","reorder_guide","delete_guide","delete_any_guide","force_delete_guide","force_delete_any_guide","view_hotel","view_any_hotel","create_hotel","update_hotel","restore_hotel","restore_any_hotel","replicate_hotel","reorder_hotel","delete_hotel","delete_any_hotel","force_delete_hotel","force_delete_any_hotel","view_invoice","view_any_invoice","create_invoice","update_invoice","restore_invoice","restore_any_invoice","replicate_invoice","reorder_invoice","delete_invoice","delete_any_invoice","force_delete_invoice","force_delete_any_invoice","view_meter","view_any_meter","create_meter","update_meter","restore_meter","restore_any_meter","replicate_meter","reorder_meter","delete_meter","delete_any_meter","force_delete_meter","force_delete_any_meter","view_rating","view_any_rating","create_rating","update_rating","restore_rating","restore_any_rating","replicate_rating","reorder_rating","delete_rating","delete_any_rating","force_delete_rating","force_delete_any_rating","view_room","view_any_room","create_room","update_room","restore_room","restore_any_room","replicate_room","reorder_room","delete_room","delete_any_room","force_delete_room","force_delete_any_room","view_room::repair","view_any_room::repair","create_room::repair","update_room::repair","restore_room::repair","restore_any_room::repair","replicate_room::repair","reorder_room::repair","delete_room::repair","delete_any_room::repair","force_delete_room::repair","force_delete_any_room::repair","view_room::type","view_any_room::type","create_room::type","update_room::type","restore_room::type","restore_any_room::type","replicate_room::type","reorder_room::type","delete_room::type","delete_any_room::type","force_delete_room::type","force_delete_any_room::type","view_scheduled::message","view_any_scheduled::message","create_scheduled::message","update_scheduled::message","restore_scheduled::message","restore_any_scheduled::message","replicate_scheduled::message","reorder_scheduled::message","delete_scheduled::message","delete_any_scheduled::message","force_delete_scheduled::message","force_delete_any_scheduled::message","view_tag","view_any_tag","create_tag","update_tag","restore_tag","restore_any_tag","replicate_tag","reorder_tag","delete_tag","delete_any_tag","force_delete_tag","force_delete_any_tag","view_terminal::check","view_any_terminal::check","create_terminal::check","update_terminal::check","restore_terminal::check","restore_any_terminal::check","replicate_terminal::check","reorder_terminal::check","delete_terminal::check","delete_any_terminal::check","force_delete_terminal::check","force_delete_any_terminal::check","view_tour","view_any_tour","create_tour","update_tour","restore_tour","restore_any_tour","replicate_tour","reorder_tour","delete_tour","delete_any_tour","force_delete_tour","force_delete_any_tour","view_tour::expense","view_any_tour::expense","create_tour::expense","update_tour::expense","restore_tour::expense","restore_any_tour::expense","replicate_tour::expense","reorder_tour::expense","delete_tour::expense","delete_any_tour::expense","force_delete_tour::expense","force_delete_any_tour::expense","view_turfirma","view_any_turfirma","create_turfirma","update_turfirma","restore_turfirma","restore_any_turfirma","replicate_turfirma","reorder_turfirma","delete_turfirma","delete_any_turfirma","force_delete_turfirma","force_delete_any_turfirma","view_user","view_any_user","create_user","update_user","restore_user","restore_any_user","replicate_user","reorder_user","delete_user","delete_any_user","force_delete_user","force_delete_any_user","view_utility","view_any_utility","create_utility","update_utility","restore_utility","restore_any_utility","replicate_utility","reorder_utility","delete_utility","delete_any_utility","force_delete_utility","force_delete_any_utility","view_utility::usage","view_any_utility::usage","create_utility::usage","update_utility::usage","restore_utility::usage","restore_any_utility::usage","replicate_utility::usage","reorder_utility::usage","delete_utility::usage","delete_any_utility::usage","force_delete_utility::usage","force_delete_any_utility::usage","view_zayavka","view_any_zayavka","create_zayavka","update_zayavka","restore_zayavka","restore_any_zayavka","replicate_zayavka","reorder_zayavka","delete_zayavka","delete_any_zayavka","force_delete_zayavka","force_delete_any_zayavka","page_Availability","page_BookingsReport","page_ExpenseReports","page_TourCalendarWidgetPage","widget_ExpenseChart","widget_StatsOverview","view_cash::transaction","view_any_cash::transaction","create_cash::transaction","update_cash::transaction","restore_cash::transaction","restore_any_cash::transaction","replicate_cash::transaction","reorder_cash::transaction","delete_cash::transaction","delete_any_cash::transaction","force_delete_cash::transaction","force_delete_any_cash::transaction","view_shift","view_any_shift","create_shift","update_shift","restore_shift","restore_any_shift","replicate_shift","reorder_shift","delete_shift","delete_any_shift","force_delete_shift","force_delete_any_shift"]},{"name":"admin","guard_name":"web","permissions":["view_amenity","view_any_amenity","create_amenity","update_amenity","restore_amenity","restore_any_amenity","replicate_amenity","reorder_amenity","delete_amenity","delete_any_amenity","force_delete_amenity","force_delete_any_amenity","view_booking","view_any_booking","create_booking","update_booking","restore_booking","restore_any_booking","replicate_booking","reorder_booking","delete_booking","delete_any_booking","force_delete_booking","force_delete_any_booking","view_car","view_any_car","create_car","update_car","restore_car","restore_any_car","replicate_car","reorder_car","delete_car","delete_any_car","force_delete_car","force_delete_any_car","view_chat","view_any_chat","create_chat","update_chat","restore_chat","restore_any_chat","replicate_chat","reorder_chat","delete_chat","delete_any_chat","force_delete_chat","force_delete_any_chat","view_contract","view_any_contract","create_contract","update_contract","restore_contract","restore_any_contract","replicate_contract","reorder_contract","delete_contract","delete_any_contract","force_delete_contract","force_delete_any_contract","view_driver","view_any_driver","create_driver","update_driver","restore_driver","restore_any_driver","replicate_driver","reorder_driver","delete_driver","delete_any_driver","force_delete_driver","force_delete_any_driver","view_employee","view_any_employee","create_employee","update_employee","restore_employee","restore_any_employee","replicate_employee","reorder_employee","delete_employee","delete_any_employee","force_delete_employee","force_delete_any_employee","view_expense","view_any_expense","create_expense","update_expense","restore_expense","restore_any_expense","replicate_expense","reorder_expense","delete_expense","delete_any_expense","force_delete_expense","force_delete_any_expense","view_guest","view_any_guest","create_guest","update_guest","restore_guest","restore_any_guest","replicate_guest","reorder_guest","delete_guest","delete_any_guest","force_delete_guest","force_delete_any_guest","view_guest::payment","view_any_guest::payment","create_guest::payment","update_guest::payment","restore_guest::payment","restore_any_guest::payment","replicate_guest::payment","reorder_guest::payment","delete_guest::payment","delete_any_guest::payment","force_delete_guest::payment","force_delete_any_guest::payment","view_guide","view_any_guide","create_guide","update_guide","restore_guide","restore_any_guide","replicate_guide","reorder_guide","delete_guide","delete_any_guide","force_delete_guide","force_delete_any_guide","view_hotel","view_any_hotel","create_hotel","update_hotel","restore_hotel","restore_any_hotel","replicate_hotel","reorder_hotel","delete_hotel","delete_any_hotel","force_delete_hotel","force_delete_any_hotel","view_invoice","view_any_invoice","create_invoice","update_invoice","restore_invoice","restore_any_invoice","replicate_invoice","reorder_invoice","delete_invoice","delete_any_invoice","force_delete_invoice","force_delete_any_invoice","view_meter","view_any_meter","create_meter","update_meter","restore_meter","restore_any_meter","replicate_meter","reorder_meter","delete_meter","delete_any_meter","force_delete_meter","force_delete_any_meter","view_rating","view_any_rating","create_rating","update_rating","restore_rating","restore_any_rating","replicate_rating","reorder_rating","delete_rating","delete_any_rating","force_delete_rating","force_delete_any_rating","view_room","view_any_room","create_room","update_room","restore_room","restore_any_room","replicate_room","reorder_room","delete_room","delete_any_room","force_delete_room","force_delete_any_room","view_room::repair","view_any_room::repair","create_room::repair","update_room::repair","restore_room::repair","restore_any_room::repair","replicate_room::repair","reorder_room::repair","delete_room::repair","delete_any_room::repair","force_delete_room::repair","force_delete_any_room::repair","view_room::type","view_any_room::type","create_room::type","update_room::type","restore_room::type","restore_any_room::type","replicate_room::type","reorder_room::type","delete_room::type","delete_any_room::type","force_delete_room::type","force_delete_any_room::type","view_scheduled::message","view_any_scheduled::message","create_scheduled::message","update_scheduled::message","restore_scheduled::message","restore_any_scheduled::message","replicate_scheduled::message","reorder_scheduled::message","delete_scheduled::message","delete_any_scheduled::message","force_delete_scheduled::message","force_delete_any_scheduled::message","view_tag","view_any_tag","create_tag","update_tag","restore_tag","restore_any_tag","replicate_tag","reorder_tag","delete_tag","delete_any_tag","force_delete_tag","force_delete_any_tag","view_terminal::check","view_any_terminal::check","create_terminal::check","update_terminal::check","restore_terminal::check","restore_any_terminal::check","replicate_terminal::check","reorder_terminal::check","delete_terminal::check","delete_any_terminal::check","force_delete_terminal::check","force_delete_any_terminal::check","view_tour","view_any_tour","create_tour","update_tour","restore_tour","restore_any_tour","replicate_tour","reorder_tour","delete_tour","delete_any_tour","force_delete_tour","force_delete_any_tour","view_tour::expense","view_any_tour::expense","create_tour::expense","update_tour::expense","restore_tour::expense","restore_any_tour::expense","replicate_tour::expense","reorder_tour::expense","delete_tour::expense","delete_any_tour::expense","force_delete_tour::expense","force_delete_any_tour::expense","view_turfirma","view_any_turfirma","create_turfirma","update_turfirma","restore_turfirma","restore_any_turfirma","replicate_turfirma","reorder_turfirma","delete_turfirma","delete_any_turfirma","force_delete_turfirma","force_delete_any_turfirma","view_user","view_any_user","create_user","update_user","restore_user","restore_any_user","replicate_user","reorder_user","delete_user","delete_any_user","force_delete_user","force_delete_any_user","view_utility","view_any_utility","create_utility","update_utility","restore_utility","restore_any_utility","replicate_utility","reorder_utility","delete_utility","delete_any_utility","force_delete_utility","force_delete_any_utility","view_utility::usage","view_any_utility::usage","create_utility::usage","update_utility::usage","restore_utility::usage","restore_any_utility::usage","replicate_utility::usage","reorder_utility::usage","delete_utility::usage","delete_any_utility::usage","force_delete_utility::usage","force_delete_any_utility::usage","view_zayavka","view_any_zayavka","create_zayavka","update_zayavka","restore_zayavka","restore_any_zayavka","replicate_zayavka","reorder_zayavka","delete_zayavka","delete_any_zayavka","force_delete_zayavka","force_delete_any_zayavka","page_Availability","page_BookingsReport","page_ExpenseReports","page_TourCalendarWidgetPage","widget_ExpenseChart","widget_StatsOverview","view reports","close any shift","manage exchange rates","view_cash::transaction","view_any_cash::transaction","create_cash::transaction","update_cash::transaction","restore_cash::transaction","restore_any_cash::transaction","replicate_cash::transaction","reorder_cash::transaction","delete_cash::transaction","delete_any_cash::transaction","force_delete_cash::transaction","force_delete_any_cash::transaction","view_shift","view_any_shift","create_shift","update_shift","restore_shift","restore_any_shift","replicate_shift","reorder_shift","delete_shift","delete_any_shift","force_delete_shift","force_delete_any_shift","view_role","view_any_role","create_role","update_role","delete_role","delete_any_role"]},{"name":"manager","guard_name":"web","permissions":["view_amenity","view_any_amenity","create_amenity","update_amenity","restore_amenity","restore_any_amenity","replicate_amenity","reorder_amenity","delete_amenity","delete_any_amenity","force_delete_amenity","force_delete_any_amenity","view_booking","view_any_booking","create_booking","update_booking","restore_booking","restore_any_booking","replicate_booking","reorder_booking","delete_booking","delete_any_booking","force_delete_booking","force_delete_any_booking","view_car","view_any_car","create_car","update_car","restore_car","restore_any_car","replicate_car","reorder_car","delete_car","delete_any_car","force_delete_car","force_delete_any_car","view_chat","view_any_chat","create_chat","update_chat","restore_chat","restore_any_chat","replicate_chat","reorder_chat","delete_chat","delete_any_chat","force_delete_chat","force_delete_any_chat","view_contract","view_any_contract","create_contract","update_contract","restore_contract","restore_any_contract","replicate_contract","reorder_contract","delete_contract","delete_any_contract","force_delete_contract","force_delete_any_contract","view_driver","view_any_driver","create_driver","update_driver","restore_driver","restore_any_driver","replicate_driver","reorder_driver","delete_driver","delete_any_driver","force_delete_driver","force_delete_any_driver","view_employee","view_any_employee","create_employee","update_employee","restore_employee","restore_any_employee","replicate_employee","reorder_employee","delete_employee","delete_any_employee","force_delete_employee","force_delete_any_employee","view_expense","view_any_expense","create_expense","update_expense","restore_expense","restore_any_expense","replicate_expense","reorder_expense","delete_expense","delete_any_expense","force_delete_expense","force_delete_any_expense","view_guest","view_any_guest","create_guest","update_guest","restore_guest","restore_any_guest","replicate_guest","reorder_guest","delete_guest","delete_any_guest","force_delete_guest","force_delete_any_guest","view_guest::payment","view_any_guest::payment","create_guest::payment","update_guest::payment","restore_guest::payment","restore_any_guest::payment","replicate_guest::payment","reorder_guest::payment","delete_guest::payment","delete_any_guest::payment","force_delete_guest::payment","force_delete_any_guest::payment","view_guide","view_any_guide","create_guide","update_guide","restore_guide","restore_any_guide","replicate_guide","reorder_guide","delete_guide","delete_any_guide","force_delete_guide","force_delete_any_guide","view_hotel","view_any_hotel","create_hotel","update_hotel","restore_hotel","restore_any_hotel","replicate_hotel","reorder_hotel","delete_hotel","delete_any_hotel","force_delete_hotel","force_delete_any_hotel","view_invoice","view_any_invoice","create_invoice","update_invoice","restore_invoice","restore_any_invoice","replicate_invoice","reorder_invoice","delete_invoice","delete_any_invoice","force_delete_invoice","force_delete_any_invoice","view_meter","view_any_meter","create_meter","update_meter","restore_meter","restore_any_meter","replicate_meter","reorder_meter","delete_meter","delete_any_meter","force_delete_meter","force_delete_any_meter","view_rating","view_any_rating","create_rating","update_rating","restore_rating","restore_any_rating","replicate_rating","reorder_rating","delete_rating","delete_any_rating","force_delete_rating","force_delete_any_rating","view_room","view_any_room","create_room","update_room","restore_room","restore_any_room","replicate_room","reorder_room","delete_room","delete_any_room","force_delete_room","force_delete_any_room","view_room::repair","view_any_room::repair","create_room::repair","update_room::repair","restore_room::repair","restore_any_room::repair","replicate_room::repair","reorder_room::repair","delete_room::repair","delete_any_room::repair","force_delete_room::repair","force_delete_any_room::repair","view_room::type","view_any_room::type","create_room::type","update_room::type","restore_room::type","restore_any_room::type","replicate_room::type","reorder_room::type","delete_room::type","delete_any_room::type","force_delete_room::type","force_delete_any_room::type","view_scheduled::message","view_any_scheduled::message","create_scheduled::message","update_scheduled::message","restore_scheduled::message","restore_any_scheduled::message","replicate_scheduled::message","reorder_scheduled::message","delete_scheduled::message","delete_any_scheduled::message","force_delete_scheduled::message","force_delete_any_scheduled::message","view_tag","view_any_tag","create_tag","update_tag","restore_tag","restore_any_tag","replicate_tag","reorder_tag","delete_tag","delete_any_tag","force_delete_tag","force_delete_any_tag","view_terminal::check","view_any_terminal::check","create_terminal::check","update_terminal::check","restore_terminal::check","restore_any_terminal::check","replicate_terminal::check","reorder_terminal::check","delete_terminal::check","delete_any_terminal::check","force_delete_terminal::check","force_delete_any_terminal::check","view_tour","view_any_tour","create_tour","update_tour","restore_tour","restore_any_tour","replicate_tour","reorder_tour","delete_tour","delete_any_tour","force_delete_tour","force_delete_any_tour","view_tour::expense","view_any_tour::expense","create_tour::expense","update_tour::expense","restore_tour::expense","restore_any_tour::expense","replicate_tour::expense","reorder_tour::expense","delete_tour::expense","delete_any_tour::expense","force_delete_tour::expense","force_delete_any_tour::expense","view_turfirma","view_any_turfirma","create_turfirma","update_turfirma","restore_turfirma","restore_any_turfirma","replicate_turfirma","reorder_turfirma","delete_turfirma","delete_any_turfirma","force_delete_turfirma","force_delete_any_turfirma","view_user","view_any_user","create_user","update_user","restore_user","restore_any_user","replicate_user","reorder_user","delete_user","delete_any_user","force_delete_user","force_delete_any_user","view_utility","view_any_utility","create_utility","update_utility","restore_utility","restore_any_utility","replicate_utility","reorder_utility","delete_utility","delete_any_utility","force_delete_utility","force_delete_any_utility","view_utility::usage","view_any_utility::usage","create_utility::usage","update_utility::usage","restore_utility::usage","restore_any_utility::usage","replicate_utility::usage","reorder_utility::usage","delete_utility::usage","delete_any_utility::usage","force_delete_utility::usage","force_delete_any_utility::usage","view_zayavka","view_any_zayavka","create_zayavka","update_zayavka","restore_zayavka","restore_any_zayavka","replicate_zayavka","reorder_zayavka","delete_zayavka","delete_any_zayavka","force_delete_zayavka","force_delete_any_zayavka","page_Availability","page_BookingsReport","page_ExpenseReports","page_TourCalendarWidgetPage","widget_ExpenseChart","widget_StatsOverview","view reports","close any shift","manage exchange rates","view_cash::transaction","view_any_cash::transaction","create_cash::transaction","update_cash::transaction","restore_cash::transaction","restore_any_cash::transaction","replicate_cash::transaction","reorder_cash::transaction","delete_cash::transaction","delete_any_cash::transaction","force_delete_cash::transaction","force_delete_any_cash::transaction","view_shift","view_any_shift","create_shift","update_shift","restore_shift","restore_any_shift","replicate_shift","reorder_shift","delete_shift","delete_any_shift","force_delete_shift","force_delete_any_shift"]},{"name":"cashier","guard_name":"web","permissions":["view_cash::transaction","view_any_cash::transaction","create_cash::transaction","update_cash::transaction","delete_cash::transaction","view_shift","view_any_shift","create_shift"]}]';
        $directPermissions = '[]';

        static::makeRolesWithPermissions($rolesWithPermissions);
        static::makeDirectPermissions($directPermissions);

        $this->command->info('Shield Seeding Completed.');
    }

    protected static function makeRolesWithPermissions(string $rolesWithPermissions): void
    {
        if (! blank($rolePlusPermissions = json_decode($rolesWithPermissions, true))) {
            /** @var Model $roleModel */
            $roleModel = Utils::getRoleModel();
            /** @var Model $permissionModel */
            $permissionModel = Utils::getPermissionModel();

            foreach ($rolePlusPermissions as $rolePlusPermission) {
                $role = $roleModel::firstOrCreate([
                    'name' => $rolePlusPermission['name'],
                    'guard_name' => $rolePlusPermission['guard_name'],
                ]);

                if (! blank($rolePlusPermission['permissions'])) {
                    $permissionModels = collect($rolePlusPermission['permissions'])
                        ->map(fn ($permission) => $permissionModel::firstOrCreate([
                            'name' => $permission,
                            'guard_name' => $rolePlusPermission['guard_name'],
                        ]))
                        ->all();

                    $role->syncPermissions($permissionModels);
                }
            }
        }
    }

    public static function makeDirectPermissions(string $directPermissions): void
    {
        if (! blank($permissions = json_decode($directPermissions, true))) {
            /** @var Model $permissionModel */
            $permissionModel = Utils::getPermissionModel();

            foreach ($permissions as $permission) {
                if ($permissionModel::whereName($permission)->doesntExist()) {
                    $permissionModel::create([
                        'name' => $permission['name'],
                        'guard_name' => $permission['guard_name'],
                    ]);
                }
            }
        }
    }
}
